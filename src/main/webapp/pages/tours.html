<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<fmt:setLocale value="${locale}" scope="session" />
<fmt:setBundle basename="lang" var="rb" />

<html>
<head>
    <title>Tour Agency</title>
    <c:import url="/resources/components/head.html"/>
    <link rel="stylesheet" href="/resources/css/tour.css"/>
    <link rel="stylesheet" href="/resources/bower_components/rateYo/src/jquery.rateyo.css"/>
    <script src="/resources/js/params.js"></script>
    <script src="/resources/js/tours.js"></script>
</head>
<body>

<c:import url="/resources/components/navbar.html"/>

<div class="container-fluid ovf-hidden">
    <div class="col-md-2 sidebar">
        <c:import url="/resources/components/sidebar.html"/>
    </div>

    <div class="col-md-offset-3 col-md-8 content stretch">
        <ul class="nav nav-pills toolbar">

            <c:set var="ordCss" value="${ord eq 'NO' ? '' : 'active'}"/>
            <c:set var="ordAsc" value="${ord eq 'ASC' ? '-alt' : ''}"/>
            <li><a class="btn btn-default ${ordCss}" onclick="sort()">
                <fmt:message key="tour.price" bundle="${rb}"/>
                <span class="glyphicon glyphicon-sort-by-order${ordAsc}"></span></a>
            </li>

            <c:set var="recreationCss" value="${RECREATION ? 'active' : ''}"/>
            <li><a class="btn btn-default ${recreationCss}" onclick="setTourType('RECREATION')">
                    <fmt:message key="tour.recreation" bundle="${rb}"/>
                </a>
            </li>

            <c:set var="excursionCss" value="${EXCURSION ? 'active' : ''}"/>
            <li><a class="btn btn-default ${excursionCss}" onclick="setTourType('EXCURSION')">
                    <fmt:message key="tour.excursion" bundle="${rb}"/>
                </a>
            </li>

            <c:set var="shoppingCss" value="${SHOPPING ? 'active' : ''}"/>
            <li><a class="btn btn-default ${shoppingCss}" onclick="setTourType('SHOPPING')">
                    <fmt:message key="tour.shopping" bundle="${rb}"/>
                </a>
            </li>
        </ul>

        <c:if test="${empty tours}">
            <fmt:message key="tours.empty" bundle="${rb}"/>
        </c:if>

        <div class="tours">
            <c:forEach var="tour" items="${tours}">

                <div class="tour-wrapper col-md-12">
                    <a href="/tour.html?id=${tour.id}">
                        <div class="tour clearfix">
                            <c:if test="${tour.isHot()}">
                                <div class="hot">
                                    <fmt:message key="tour.hothint" var="hothint" bundle="${rb}"/>
                                    <img src="/resources/images/hot.png"
                                         title="${hothint}">
                                </div>
                            </c:if>

                            <div class="heading">
                                <c:out value="${tour.title}"/>
                            </div>
                            <div class="body">
                                <c:out value="${tour.description}"/>
                            </div>
                            <div class="footer">
                                <div class="pull-left badge" style="line-height: 20px">
                                    $<c:out value="${tour.price.doubleValue()}"/>
                                </div>
                                <div class="pull-right">
                                    <div class="vcentered-container">
                                        <div class="stars vcentered" style="display: inline-block"
                                             data-rating="${tour.avgRating}">
                                        </div>
                                        <div class="counter inline vcentered">
                                            ${tour.votesCount}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>

            </c:forEach>
        </div>


        <c:if test="${not empty nextId || empty tours}">
            <form method="post" class="fix-footer-overlay pull-right">
                <input type="hidden" name="__method" value="get"/>
                <input type="hidden" name="direction" value="+1"/>
                <input type="hidden" name="currId" value="${nextId}"/>
                <input type="hidden" name="currPrice" value="${nextPrice}"/>
                <a href="#" class="btn btn-default" onclick="this.parentNode.submit()"><i class="glyphicon glyphicon-menu-right"></i></a>
            </form>
        </c:if>

        <c:if test="${not empty tours}">
            <form method="post" class="fix-footer-overlay pull-right">
                <input type="hidden" name="__method" value="get"/>
                <input type="hidden" name="direction" value="-1"/>
                <input type="hidden" name="currId" value="${prevId}"/>
                <input type="hidden" name="currPrice" value="${prevPrice}"/>
                <a href="#" class="btn btn-default" onclick="this.parentNode.submit()"><i class="glyphicon glyphicon-menu-left"></i></a>
            </form>
        </c:if>

    </div>
</div>

<script src="/resources/bower_components/rateYo/src/jquery.rateyo.js"></script>

<script>
$(function () {

  $('.stars').each(function() {
    var $this = $(this);
    $this.rateYo({
        rating: $this.data('rating') || 0,
        readOnly: true,
        starWidth: '17px'
    });
  });

});
</script>

</body>
</html>